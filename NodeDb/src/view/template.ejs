<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
</head>
<body>
    <h3>Adding data to my list:</h3>
    <input type="text" placeholder="Enter Your Task" id="task-detail">
    <button id="add-task">Add Task</button>
    
    <h3>Tasks:</h3>
    <ol id="task-list">
        <% taskList.forEach((task) => { %>
            <li>
                <span class="task-name"><%- task.name %></span>
                
                
                <button class="delete"  data-task-id="<%- task.id %>">Delete</button>
                <button class="edit"  data-task-id="<%- task.id %>">Edit</button>
            </li>
        <% }) %>
        </ol>

    <script>
        var addTaskBtn = document.querySelector('#add-task');
        var taskList = document.querySelector('#task-list');

        addTaskBtn.addEventListener('click', function () {
            const inputItem = document.querySelector('#task-detail');
            const taskName = inputItem.value;
            const taskId = event.target.getAttribute('data-task-id')
            

            console.log('>>>>>>>>>>>>>>>>>>>>',taskId);
 // Send a request to add a new task
            fetch('/create-task', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ task: taskName })
            })
            .then(result => result.json())
            .then(data => {
                if (data.status === 'done') {
                    // Append the new task to the task list without refreshing
                    const taskItem = document.createElement('li');
                    taskItem.innerHTML = `
                          <span>${taskName}</span>
                        <button class="delete" data-task-id="${taskId}">Delete</button>
                        <button class="edit" data-task-id1="${taskId1}">Edit</button>`;
                    taskList.appendChild(taskItem);
                    inputItem.value = ''; // Clear the input field
                } else {
                    alert('Failed to add the task.');
                }
            });
        });

// for deleting 

        taskList.addEventListener('click',function(event){
            if (event.target.classList.contains('delete')) {
                const listItem = event.target.parentElement;
                const taskId = event.target.getAttribute('data-task-id');
                // Send a request to delete the task
                fetch('/delete-task', {
                    method: 'post',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ task: taskId })
                })
                .then(result => result.json())
                .then(data => {
                    if (data.status === 'done') {
                        listItem.remove(); // Remove the task from the list
                    } else {
                        alert('Failed to delete the task.');
                    }
                });
            }

        });

        // Edit task
taskList.addEventListener('click', function (event) {
    if (event.target.classList.contains('edit')) {
        event.preventDefault(); // Prevent any default action (e.g., form submission)

        // Instead of immediately handling the edit, you should find the closest task element (li)
        const listItem = event.target.closest('li');
        console.log('closeset li item >>>>>>>>>',listItem)
        const taskId1 = event.target.getAttribute('data-task-id1');
        const taskNameElement = listItem.querySelector('.task-name');
        const taskName = taskNameElement.textContent;

        // Display an edit form or input field
        const editForm = document.createElement('form');
        editForm.innerHTML = `
            <input type="text" class="edit-input" value="${taskName}">
            <button class="save" data-task-id="${taskId1}">Save</button>
        `;
        listItem.appendChild(editForm);

        // Hide the task name
        taskNameElement.style.display = 'none';
        event.target.style.display = 'none';

        // Listen for save button click
        editForm.addEventListener('click', function (event) {
            if (event.target.classList.contains('save')) {
                event.preventDefault(); // Prevent any default action (e.g., form submission)
                const editedTaskName = editForm.querySelector('.edit-input').value;

                // Send a request to update the task
                fetch('/update-task', {
                    method: 'post',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: taskId1, name: editedTaskName })
                })
                .then(result => result.json())
                .then(data => {
                    if (data.status === 'done') {
                        // Update the task name on the page
                        taskNameElement.textContent = editedTaskName;
                    } else {
                        alert('Failed to update the task.');
                    }

                    // Remove the edit form
                    editForm.remove();

                    // Show the task name and edit button again
                    taskNameElement.style.display = 'inline';
                    event.target.style.display = 'inline';
                });
            }
        });
    }
});


       
           

    </script>
</body>
</html>
